import ('import')
WHITE_SPACE (' ')
identifier ('ballerina')
/ ('/')
identifier ('io')
; (';')
WHITE_SPACE ('\n')
import ('import')
WHITE_SPACE (' ')
identifier ('ballerina')
/ ('/')
identifier ('runtime')
; (';')
WHITE_SPACE ('\n\n')
LINE_COMMENT ('// Create a record type named `StatusCount`.')
WHITE_SPACE ('\n')
type ('type')
WHITE_SPACE (' ')
identifier ('StatusCount')
WHITE_SPACE (' ')
record ('record')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n    ')
string ('string')
WHITE_SPACE (' ')
identifier ('status')
; (';')
WHITE_SPACE ('\n    ')
int ('int')
WHITE_SPACE (' ')
identifier ('totalCount')
; (';')
WHITE_SPACE ('\n')
} ('}')
; (';')
WHITE_SPACE ('\n\n')
LINE_COMMENT ('// Create a record type named `Teacher` and define the attributes.')
WHITE_SPACE ('\n')
type ('type')
WHITE_SPACE (' ')
identifier ('Teacher')
WHITE_SPACE (' ')
record ('record')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n    ')
string ('string')
WHITE_SPACE (' ')
identifier ('name')
; (';')
WHITE_SPACE ('\n    ')
int ('int')
WHITE_SPACE (' ')
identifier ('age')
; (';')
WHITE_SPACE ('\n    ')
string ('string')
WHITE_SPACE (' ')
identifier ('status')
; (';')
WHITE_SPACE ('\n    ')
string ('string')
WHITE_SPACE (' ')
identifier ('batch')
; (';')
WHITE_SPACE ('\n    ')
string ('string')
WHITE_SPACE (' ')
identifier ('school')
; (';')
WHITE_SPACE ('\n')
} ('}')
; (';')
WHITE_SPACE ('\n\n')
function ('function')
WHITE_SPACE (' ')
identifier ('testAggregationQuery')
( ('(')
WHITE_SPACE ('\n    ')
stream ('stream')
< ('<')
identifier ('StatusCount')
> ('>')
WHITE_SPACE (' ')
identifier ('filteredStatusCountStream')
, (',')
WHITE_SPACE ('\n    ')
stream ('stream')
< ('<')
identifier ('Teacher')
> ('>')
WHITE_SPACE (' ')
identifier ('teacherStream')
) (')')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// Create a forever statement block with an appropriate streaming query.')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// Write a query to filter teachers who are older than 18 years, wait for the stream to collect three teacher')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// objects, group the 3 teachers based on their marital status, and then obtain the ')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// unique marital status counts.')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// Once the query is executed, publish the result to the `filteredStatusCountStream` stream.')
WHITE_SPACE ('\n    ')
forever ('forever')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n        ')
from ('from')
WHITE_SPACE (' ')
identifier ('teacherStream')
WHITE_SPACE (' ')
where ('where')
WHITE_SPACE (' ')
identifier ('age')
WHITE_SPACE (' ')
> ('>')
WHITE_SPACE (' ')
DECIMAL_INTEGER_LITERAL ('18')
WHITE_SPACE (' ')
window ('window')
WHITE_SPACE (' ')
identifier ('lengthBatch')
( ('(')
DECIMAL_INTEGER_LITERAL ('3')
) (')')
WHITE_SPACE ('\n        ')
select ('select')
WHITE_SPACE (' ')
identifier ('status')
, (',')
WHITE_SPACE (' ')
identifier ('count')
( ('(')
identifier ('status')
) (')')
WHITE_SPACE (' ')
as ('as')
WHITE_SPACE (' ')
identifier ('totalCount')
WHITE_SPACE ('\n        ')
group ('group')
WHITE_SPACE (' ')
by ('by')
WHITE_SPACE (' ')
identifier ('status')
WHITE_SPACE ('\n        ')
having ('having')
WHITE_SPACE (' ')
identifier ('totalCount')
WHITE_SPACE (' ')
> ('>')
WHITE_SPACE (' ')
DECIMAL_INTEGER_LITERAL ('1')
WHITE_SPACE ('\n        ')
=> ('=>')
WHITE_SPACE (' ')
( ('(')
identifier ('StatusCount')
[ ('[')
] (']')
WHITE_SPACE (' ')
identifier ('status')
) (')')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n            ')
identifier ('filteredStatusCountStream')
. ('.')
identifier ('publish')
( ('(')
identifier ('status')
) (')')
; (';')
WHITE_SPACE ('\n        ')
} ('}')
WHITE_SPACE ('\n    ')
} ('}')
WHITE_SPACE ('\n')
} ('}')
WHITE_SPACE ('\n\n')
function ('function')
WHITE_SPACE (' ')
identifier ('main')
( ('(')
string ('string')
... ('...')
WHITE_SPACE (' ')
identifier ('args')
) (')')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// Create a stream that is constrained by the `StatusCount` record type.')
WHITE_SPACE ('\n    ')
stream ('stream')
< ('<')
identifier ('StatusCount')
> ('>')
WHITE_SPACE (' ')
identifier ('filteredStatusCountStream')
; (';')
WHITE_SPACE ('\n\n    ')
LINE_COMMENT ('// Create a stream that is constrained by the `Teacher` record type.')
WHITE_SPACE ('\n    ')
stream ('stream')
< ('<')
identifier ('Teacher')
> ('>')
WHITE_SPACE (' ')
identifier ('teacherStream')
; (';')
WHITE_SPACE ('\n\n    ')
LINE_COMMENT ('//Invoke the method that contains the forever streaming statement.')
WHITE_SPACE ('\n    ')
identifier ('testAggregationQuery')
( ('(')
identifier ('filteredStatusCountStream')
, (',')
WHITE_SPACE (' ')
identifier ('teacherStream')
) (')')
; (';')
WHITE_SPACE ('\n\n    ')
LINE_COMMENT ('// Create sample events, and send the events to the `teacherStream` input stream.')
WHITE_SPACE ('\n    ')
identifier ('Teacher')
WHITE_SPACE (' ')
identifier ('t1')
WHITE_SPACE (' ')
= ('=')
WHITE_SPACE (' ')
{ ('{')
identifier ('name')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"Sam"')
, (',')
WHITE_SPACE (' ')
identifier ('age')
: (':')
WHITE_SPACE (' ')
DECIMAL_INTEGER_LITERAL ('25')
, (',')
WHITE_SPACE (' ')
identifier ('status')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"single"')
, (',')
WHITE_SPACE ('\n        ')
identifier ('batch')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"LK2014"')
, (',')
WHITE_SPACE (' ')
identifier ('school')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"Hampden High School"')
} ('}')
; (';')
WHITE_SPACE ('\n    ')
identifier ('Teacher')
WHITE_SPACE (' ')
identifier ('t2')
WHITE_SPACE (' ')
= ('=')
WHITE_SPACE (' ')
{ ('{')
identifier ('name')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"Jordan"')
, (',')
WHITE_SPACE (' ')
identifier ('age')
: (':')
WHITE_SPACE (' ')
DECIMAL_INTEGER_LITERAL ('33')
, (',')
WHITE_SPACE (' ')
identifier ('status')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"single"')
, (',')
WHITE_SPACE ('\n        ')
identifier ('batch')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"LK1998"')
, (',')
WHITE_SPACE (' ')
identifier ('school')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"Columbia High School"')
} ('}')
; (';')
WHITE_SPACE ('\n    ')
identifier ('Teacher')
WHITE_SPACE (' ')
identifier ('t3')
WHITE_SPACE (' ')
= ('=')
WHITE_SPACE (' ')
{ ('{')
identifier ('name')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"Morgan"')
, (',')
WHITE_SPACE (' ')
identifier ('age')
: (':')
WHITE_SPACE (' ')
DECIMAL_INTEGER_LITERAL ('45')
, (',')
WHITE_SPACE (' ')
identifier ('status')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"married"')
, (',')
WHITE_SPACE ('\n        ')
identifier ('batch')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"LK1988"')
, (',')
WHITE_SPACE (' ')
identifier ('school')
: (':')
WHITE_SPACE (' ')
QUOTED_STRING_LITERAL ('"Central High School"')
} ('}')
; (';')
WHITE_SPACE ('\n\n    ')
LINE_COMMENT ('// Subscribe the `filteredStatusCountStream` stream to the `printStatusCount` function. Each time the stream')
WHITE_SPACE ('\n    ')
LINE_COMMENT ('// receives an event, call the `printStatusCount` function.')
WHITE_SPACE ('\n    ')
identifier ('filteredStatusCountStream')
. ('.')
identifier ('subscribe')
( ('(')
identifier ('printStatusCount')
) (')')
; (';')
WHITE_SPACE ('\n\n    ')
LINE_COMMENT ('// Publish the events that are generated.')
WHITE_SPACE ('\n    ')
identifier ('teacherStream')
. ('.')
identifier ('publish')
( ('(')
identifier ('t1')
) (')')
; (';')
WHITE_SPACE ('\n    ')
identifier ('teacherStream')
. ('.')
identifier ('publish')
( ('(')
identifier ('t2')
) (')')
; (';')
WHITE_SPACE ('\n    ')
identifier ('teacherStream')
. ('.')
identifier ('publish')
( ('(')
identifier ('t3')
) (')')
; (';')
WHITE_SPACE ('\n\n    ')
identifier ('runtime')
: (':')
identifier ('sleep')
( ('(')
DECIMAL_INTEGER_LITERAL ('1000')
) (')')
; (';')
WHITE_SPACE ('\n')
} ('}')
WHITE_SPACE ('\n\n')
LINE_COMMENT ('// Print the output events.')
WHITE_SPACE ('\n')
function ('function')
WHITE_SPACE (' ')
identifier ('printStatusCount')
( ('(')
identifier ('StatusCount')
WHITE_SPACE (' ')
identifier ('s')
) (')')
WHITE_SPACE (' ')
{ ('{')
WHITE_SPACE ('\n    ')
identifier ('io')
: (':')
identifier ('println')
( ('(')
QUOTED_STRING_LITERAL ('"Event received; status: "')
WHITE_SPACE (' ')
+ ('+')
WHITE_SPACE (' ')
identifier ('s')
. ('.')
identifier ('status')
WHITE_SPACE (' ')
+ ('+')
WHITE_SPACE ('\n            ')
QUOTED_STRING_LITERAL ('", total occurrences: "')
WHITE_SPACE (' ')
+ ('+')
WHITE_SPACE (' ')
identifier ('s')
. ('.')
identifier ('totalCount')
) (')')
; (';')
WHITE_SPACE ('\n')
} ('}')
